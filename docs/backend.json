
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Wallet Exchange system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "walletBalance": {
          "type": "number",
          "description": "The user's current wallet balance in BDT."
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "ExchangeRate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExchangeRate",
      "type": "object",
      "description": "Represents the exchange rate between two currencies.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the exchange rate."
        },
        "fromCurrency": {
          "type": "string",
          "description": "The source currency code (e.g., USD, BDT)."
        },
        "toCurrency": {
          "type": "string",
          "description": "The destination currency code (e.g., USD, BDT)."
        },
        "rate": {
          "type": "number",
          "description": "The exchange rate value."
        },
        "lastUpdated": {
          "type": "string",
          "description": "The timestamp when the exchange rate was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "fromCurrency",
        "toCurrency",
        "rate",
        "lastUpdated"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a transaction made by a user. Can be an exchange, a card top-up, or adding funds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "paymentMethod": {
          "type": "string",
          "description": "The payment method used for the transaction (e.g., Bkash, Nagad, PayPal)."
        },
        "withdrawalMethod": {
          "type": "string",
          "description": "The withdrawal method chosen for the transaction (e.g., Bkash, Nagad, PayPal, or 'Virtual Card Top Up')."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "currency": {
          "type": "string",
          "description": "The currency of the transaction (e.g., USD, BDT)."
        },
        "exchangeRateId": {
          "type": "string",
          "description": "Reference to ExchangeRate. (Relationship: Transaction 1:1 ExchangeRate)"
        },
        "receivedAmount": {
          "type": "number",
          "description": "The amount received after exchange."
        },
        "status": {
          "type": "string",
          "description": "The status of the transaction (e.g., Complete, Processing, Paid)."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time of the transaction.",
          "format": "date-time"
        },
        "sendingAccountId": {
          "type": "string",
          "description": "The account identifier (e.g., email, phone number) from which the user sent funds."
        },
        "transactionId": {
          "type": "string",
          "description": "The transaction ID provided by the payment gateway after the user has paid."
        },
        "receivingAccountId": {
          "type": "string",
          "description": "The account identifier (e.g., phone number) where the user will receive funds."
        },
        "transactionFee": {
          "type": "number",
          "description": "The fee charged for the transaction."
        },
        "transactionType": {
          "type": "string",
          "description": "The type of transaction.",
          "enum": ["EXCHANGE", "CARD_TOP_UP", "ADD_FUNDS"]
        },
        "topUpDetails": {
          "type": "object",
          "description": "Details specific to a card top-up transaction.",
          "properties": {
            "sentAmount": { "type": "number" },
            "sentCurrency": { "type": "string" },
            "topUpAmountUSD": { "type": "number" }
          }
        }
      },
      "required": [
        "id",
        "userId",
        "paymentMethod",
        "withdrawalMethod",
        "amount",
        "currency",
        "exchangeRateId",
        "receivedAmount",
        "status",
        "transactionDate",
        "sendingAccountId",
        "transactionId",
        "receivingAccountId",
        "transactionFee",
        "transactionType"
      ]
    },
    "CardApplication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CardApplication",
      "type": "object",
      "description": "Represents a user's application for a virtual card.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who applied."
        },
        "name": {
          "type": "string",
          "description": "Applicant's full name."
        },
        "email": {
          "type": "string",
          "description": "Applicant's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Applicant's phone number."
        },
        "billingAddress": {
          "type": "string",
          "description": "Applicant's billing address."
        },
        "status": {
          "type": "string",
          "description": "The status of the application.",
          "enum": ["Pending", "Approved", "Rejected"]
        },
        "appliedAt": {
          "type": "string",
          "description": "The timestamp when the application was submitted.",
          "format": "date-time"
        },
        "cardNumber": {
          "type": "string",
          "description": "The issued card number."
        },
        "expiryDate": {
          "type": "string",
          "description": "The card's expiration date (MM/YY)."
        },
        "cvc": {
          "type": "string",
          "description": "The card's CVC code."
        },
        "adminInstruction": {
          "type": "string",
          "description": "An instruction or note from the admin to the card applicant."
        }
      },
      "required": [
        "userId",
        "name",
        "email",
        "phone",
        "billingAddress",
        "status",
        "appliedAt"
      ]
    },
    "ExchangeLimit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExchangeLimit",
      "type": "object",
      "description": "Defines minimum and maximum transaction limits for currency pairs.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the limit rule."
        },
        "fromMethod": {
            "type": "string",
            "description": "The source payment method ID (e.g., 'paypal', 'bkash')."
        },
        "toMethod": {
            "type": "string",
            "description": "The destination payment method ID (e.g., 'bkash', 'paypal')."
        },
        "fromCurrency": {
          "type": "string",
          "description": "The source currency (e.g., 'USD', 'BDT')."
        },
        "toCurrency": {
          "type": "string",
          "description": "The destination currency (e.g., 'BDT', 'USD')."
        },
        "minAmount": {
          "type": "number",
          "description": "The minimum amount allowed for this exchange, in the source currency."
        },
        "maxAmount": {
          "type": "number",
          "description": "The maximum amount allowed for this exchange, in the source currency."
        }
      },
      "required": [
        "id",
        "fromMethod",
        "toMethod",
        "minAmount",
        "maxAmount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Transactions are stored as subcollections for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/exchange_rates/{exchangeRateId}",
        "definition": {
          "entityName": "ExchangeRate",
          "schema": {
            "$ref": "#/backend/entities/ExchangeRate"
          },
          "description": "Stores exchange rates between different currencies.  These rates are managed by admins and used for transaction calculations.",
          "params": [
            {
              "name": "exchangeRateId",
              "description": "The unique identifier for the exchange rate."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores all transaction data for each user, including exchanges and card top-ups. It supports path-based ownership ensuring only the user can read/write their own transaction data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/card_applications/{applicationId}",
        "definition": {
          "entityName": "CardApplication",
          "schema": {
            "$ref": "#/backend/entities/CardApplication"
          },
          "description": "Stores card application data. A user can only have one application, identified by their UID.",
          "params": [
            {
              "name": "applicationId",
              "description": "The unique identifier for the card application, typically the user's UID."
            }
          ]
        }
      },
      {
        "path": "/exchange_limits/{limitId}",
        "definition": {
          "entityName": "ExchangeLimit",
          "schema": {
            "$ref": "#/backend/entities/ExchangeLimit"
          },
          "description": "Stores minimum and maximum transaction limits for currency pairs. Managed by admins.",
          "params": [
            {
              "name": "limitId",
              "description": "The unique identifier for the exchange limit rule."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage users, exchange rates, and transactions within the Wallet Exchange application. It prioritizes authorization independence by using path-based ownership for user data and storing user-specific transactions under their respective user documents. Exchange rates are stored in a separate collection, accessible for read operations to all users, while only admins can update the data. Card top-ups and fund deposits are now part of the main transactions collection, differentiated by a `transactionType` field, which simplifies queries and keeps all user financial activities in one place. Each user document also contains a `walletBalance` field to track their funds."
  }
}
